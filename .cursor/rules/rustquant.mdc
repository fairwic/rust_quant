---
alwaysApply: true
---

# Rust Quant ä»£ç æ”¾ç½®è§„èŒƒ

## ğŸ“¦ åŒ…ç»“æ„å¿«é€Ÿå‚è€ƒ

```
crates/
â”œâ”€â”€ common/          # é€šç”¨å·¥å…· (3+åŒ…ä½¿ç”¨)
â”œâ”€â”€ core/            # æ ¸å¿ƒåŸºç¡€è®¾æ–½ (é…ç½®ã€æ—¥å¿—ã€æ•°æ®åº“è¿æ¥æ± )
â”œâ”€â”€ domain/          # é¢†åŸŸæ¨¡å‹ (å®ä½“ã€å€¼å¯¹è±¡ã€æšä¸¾ã€æ¥å£)
â”œâ”€â”€ infrastructure/  # åŸºç¡€è®¾æ–½å®ç° (Repositoryã€ç¼“å­˜)
â”œâ”€â”€ services/        # åº”ç”¨æœåŠ¡å±‚ (ä¸šåŠ¡åè°ƒ)
â”œâ”€â”€ market/          # å¸‚åœºæ•°æ® (WebSocketã€æ•°æ®å­˜å‚¨)
â”œâ”€â”€ indicators/      # æŠ€æœ¯æŒ‡æ ‡è®¡ç®— (çº¯å‡½æ•°)
â”œâ”€â”€ strategies/      # ç­–ç•¥å¼•æ“ (ç­–ç•¥å®ç°ã€å›æµ‹)
â”œâ”€â”€ risk/            # é£é™©ç®¡ç† (ä»“ä½ã€è®¢å•ã€è´¦æˆ·é£æ§)
â”œâ”€â”€ execution/       # è®¢å•æ‰§è¡Œ (è®¢å•åˆ›å»ºã€æäº¤ã€è·Ÿè¸ª)
â”œâ”€â”€ orchestration/   # ä»»åŠ¡è°ƒåº¦ (å®šæ—¶ä»»åŠ¡ã€å·¥ä½œæµ)
â”œâ”€â”€ analytics/       # åˆ†ææŠ¥å‘Š (æ€§èƒ½åˆ†æã€æŠ¥è¡¨)
â”œâ”€â”€ ai-analysis/     # AIåˆ†æ (æƒ…ç»ªåˆ†æã€äº‹ä»¶æ£€æµ‹)
â””â”€â”€ rust-quant-cli/  # ç¨‹åºå…¥å£ (main.rs)
```

---

## ğŸ¯ ä»£ç æ”¾ç½®å†³ç­–æ ‘

### Q1: è¿™æ˜¯ä¸šåŠ¡é€»è¾‘è¿˜æ˜¯åŸºç¡€è®¾æ–½ï¼Ÿ
- **åŸºç¡€è®¾æ–½** â†’ `infrastructure/` æˆ– `core/`
- **ä¸šåŠ¡é€»è¾‘** â†’ ç»§ç»­ Q2

### Q2: æ˜¯çº¯ç²¹çš„é¢†åŸŸæ¦‚å¿µå—ï¼Ÿ
- **æ˜¯** â†’ `domain/`
- **å¦** â†’ ç»§ç»­ Q3

### Q3: æ˜¯å“ªç§ä¸šåŠ¡é€»è¾‘ï¼Ÿ
- **æŠ€æœ¯æŒ‡æ ‡è®¡ç®—** â†’ `indicators/`
- **ç­–ç•¥ä¿¡å·ç”Ÿæˆ** â†’ `strategies/`
- **é£é™©æ§åˆ¶** â†’ `risk/`
- **è®¢å•æ‰§è¡Œ** â†’ `execution/`
- **ä»»åŠ¡è°ƒåº¦** â†’ `orchestration/`
- **åˆ†ææŠ¥å‘Š** â†’ `analytics/`
- **AIåˆ†æ** â†’ `ai-analysis/`
- **å¸‚åœºæ•°æ®** â†’ `market/`
- **ä¸šåŠ¡åè°ƒ** â†’ `services/`

### Q4: æ˜¯é€šç”¨å·¥å…·å—ï¼Ÿ
- **é€šç”¨ (3+åŒ…ä½¿ç”¨)** â†’ `common/`
- **é…ç½®/åŸºç¡€è®¾æ–½** â†’ `core/`

---

## ğŸ“ è¯¦ç»†ç›®å½•æ˜ å°„

### `domain/` - é¢†åŸŸæ¨¡å‹
**èŒè´£**: çº¯ç²¹çš„ä¸šåŠ¡é€»è¾‘ï¼Œé›¶å¤–éƒ¨ä¾èµ–

**æ”¾ç½®è§„åˆ™**:
- âœ… ä¸šåŠ¡å®ä½“ â†’ `domain/src/entities/xxx.rs`
- âœ… å€¼å¯¹è±¡ (Price, Volume) â†’ `domain/src/value_objects/xxx.rs`
- âœ… ä¸šåŠ¡æšä¸¾ â†’ `domain/src/enums/xxx_enums.rs`
- âœ… é¢†åŸŸæ¥å£ â†’ `domain/src/traits/xxx_trait.rs`
- âœ… ä¸šåŠ¡é”™è¯¯ â†’ `domain/src/entities/xxx.rs` æˆ– `domain/src/value_objects/xxx.rs`

**ç¦æ­¢**:
- âŒ sqlx, redis, tokio ç­‰æ¡†æ¶ä¾èµ–
- âŒ æ•°æ®åº“æ“ä½œã€ç½‘ç»œè¯·æ±‚ã€æ–‡ä»¶IO

---

### `infrastructure/` - åŸºç¡€è®¾æ–½å®ç°
**èŒè´£**: å®ç°domainæ¥å£ï¼Œæ•°æ®è®¿é—®ã€ç¼“å­˜

**æ”¾ç½®è§„åˆ™**:
- âœ… Repositoryå®ç° â†’ `infrastructure/src/repositories/xxx_repository.rs`
- âœ… æ•°æ®åº“Entity (FromRow) â†’ `infrastructure/src/repositories/xxx_repository.rs`
- âœ… ç¼“å­˜å®ç° â†’ `infrastructure/src/cache/xxx_cache.rs`
- âœ… æ¶ˆæ¯ä¼ é€’ â†’ `infrastructure/src/messaging/xxx.rs`

**è¦æ±‚**:
- âœ… å¿…é¡»å®ç° `domain::traits` ä¸­çš„æ¥å£
- âœ… Entity â†’ Domain è½¬æ¢æ–¹æ³•: `to_domain()`
- âœ… Domain â†’ Entity è½¬æ¢æ–¹æ³•: `from_domain()`

---

### `services/` - åº”ç”¨æœåŠ¡å±‚
**èŒè´£**: åè°ƒå¤šä¸ªé¢†åŸŸå¯¹è±¡ï¼Œå®ç°å¤æ‚ä¸šåŠ¡æµç¨‹

**æ”¾ç½®è§„åˆ™**:
- âœ… ç­–ç•¥æœåŠ¡ â†’ `services/src/strategy/xxx_service.rs`
- âœ… äº¤æ˜“æœåŠ¡ â†’ `services/src/trading/xxx_service.rs`
- âœ… å¸‚åœºæœåŠ¡ â†’ `services/src/market/xxx_service.rs`
- âœ… é£æ§æœåŠ¡ â†’ `services/src/risk/xxx_service.rs`

**è¦æ±‚**:
- âœ… **ä¾èµ–domainæ¥å£**: ä½¿ç”¨ `domain::traits::XxxRepository` (trait)ï¼Œè€Œä¸æ˜¯infrastructureçš„å…·ä½“å®ç°
- âœ… **ä¾èµ–æ³¨å…¥**: é€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥infrastructureçš„å…·ä½“å®ç°ï¼Œä½†å­—æ®µç±»å‹å£°æ˜ä¸ºtraitç±»å‹
- âœ… åè°ƒå¤šä¸ªdomainèšåˆæ ¹
- âœ… å®šä¹‰äº‹åŠ¡è¾¹ç•Œ

**ç¤ºä¾‹**:
```rust
// âœ… æ­£ç¡®: ä¾èµ–domainæ¥å£
use rust_quant_domain::traits::CandleRepository;
use rust_quant_infrastructure::repositories::SqlxCandleRepository;

pub struct CandleService {
    repository: Box<dyn CandleRepository>,  // traitç±»å‹
}

impl CandleService {
    pub fn new(repo: SqlxCandleRepository) -> Self {
        Self { repository: Box::new(repo) }  // æ³¨å…¥å…·ä½“å®ç°
    }
}

// âŒ é”™è¯¯: ç›´æ¥ä¾èµ–infrastructureå…·ä½“ç±»å‹
pub struct CandleService {
    repository: SqlxCandleRepository,  // âŒ è¿åä¾èµ–å€’ç½®
}
```

---

### `strategies/` - ç­–ç•¥å¼•æ“
**èŒè´£**: ç­–ç•¥æ¡†æ¶ã€å…·ä½“ç­–ç•¥å®ç°ã€å›æµ‹

**æ”¾ç½®è§„åˆ™**:
- âœ… ç­–ç•¥æ¡†æ¶ â†’ `strategies/src/framework/xxx.rs`
- âœ… å…·ä½“ç­–ç•¥å®ç° â†’ `strategies/src/implementations/xxx_executor.rs`
- âœ… å›æµ‹å¼•æ“ â†’ `strategies/src/backtesting/xxx.rs`
- âœ… ç­–ç•¥ç¼“å­˜ â†’ `strategies/src/cache/xxx.rs`

**è¦æ±‚**:
- âœ… å®ç° `domain::traits::Strategy` æ¥å£
- âœ… ä½¿ç”¨ `indicators` è®¡ç®—æŒ‡æ ‡
- âœ… è¿”å› `domain::SignalResult`

**ç¦æ­¢**:
- âŒ ç›´æ¥æ•°æ®åº“æ“ä½œ (ä½¿ç”¨infrastructure)
- âŒ ç›´æ¥Redisæ“ä½œ (ä½¿ç”¨infrastructure)

---

### `indicators/` - æŠ€æœ¯æŒ‡æ ‡
**èŒè´£**: çº¯è®¡ç®—é€»è¾‘ï¼Œæ— ä¸šåŠ¡é€»è¾‘

**æ”¾ç½®è§„åˆ™**:
- âœ… è¶‹åŠ¿æŒ‡æ ‡ â†’ `indicators/src/trend/xxx.rs`
- âœ… åŠ¨é‡æŒ‡æ ‡ â†’ `indicators/src/momentum/xxx.rs`
- âœ… æ³¢åŠ¨ç‡æŒ‡æ ‡ â†’ `indicators/src/volatility/xxx.rs`
- âœ… æˆäº¤é‡æŒ‡æ ‡ â†’ `indicators/src/volume/xxx.rs`
- âœ… å½¢æ€è¯†åˆ« â†’ `indicators/src/pattern/xxx.rs`
- âœ… å¤æ‚æŒ‡æ ‡ç³»ç»Ÿ â†’ `indicators/src/trend/xxx/` (ç›®å½•)

**è¦æ±‚**:
- âœ… çº¯å‡½æ•°ï¼Œæ— å‰¯ä½œç”¨
- âœ… æ¥å— `&[Candle]` æˆ– `&[f64]`
- âœ… è¿”å›æ˜ç¡®çš„ç±»å‹

**ç¦æ­¢**:
- âŒ æ•°æ®åº“æ“ä½œã€ç¼“å­˜æ“ä½œã€ç­–ç•¥å†³ç­–

---

### `risk/` - é£é™©ç®¡ç†
**èŒè´£**: ä»“ä½ã€è®¢å•ã€è´¦æˆ·é£æ§

**æ”¾ç½®è§„åˆ™**:
- âœ… è®¢å•é£æ§ â†’ `risk/src/order/xxx.rs`
- âœ… æŒä»“é£æ§ â†’ `risk/src/position/xxx.rs`
- âœ… è´¦æˆ·é£æ§ â†’ `risk/src/account/xxx.rs`
- âœ… é£æ§ç­–ç•¥ â†’ `risk/src/policies/xxx_policy.rs`
- âœ… å›æµ‹æ¨¡å‹ â†’ `risk/src/backtest/xxx.rs`

**è¦æ±‚**:
- âœ… ä½¿ç”¨sqlx (FromRow)
- âœ… é£æ§è§„åˆ™é›†ä¸­åœ¨ `policies/`

**ç¦æ­¢**:
- âŒ ç­–ç•¥ä¿¡å·ç”Ÿæˆ (å±äºstrategies)

---

### `execution/` - è®¢å•æ‰§è¡Œ
**èŒè´£**: è®¢å•åˆ›å»ºã€æäº¤ã€è·Ÿè¸ªã€æ’¤å•

**æ”¾ç½®è§„åˆ™**:
- âœ… æ‰§è¡Œå¼•æ“ â†’ `execution/src/execution_engine/xxx.rs`
- âœ… è®¢å•ç®¡ç† â†’ `execution/src/order_manager/xxx_service.rs`
- âœ… æŒä»“ç®¡ç† â†’ `execution/src/position_manager/xxx.rs`

**è¦æ±‚**:
- âœ… è°ƒç”¨äº¤æ˜“æ‰€API (okx SDK)
- âœ… ä½¿ç”¨riskåŒ…çš„è®¢å•æ¨¡å‹

**ç¦æ­¢**:
- âŒ ç­–ç•¥å†³ç­– (å±äºstrategies)
- âŒ é£æ§é€»è¾‘ (å±äºrisk)

---

### `market/` - å¸‚åœºæ•°æ®
**èŒè´£**: WebSocketæ•°æ®æµã€å¸‚åœºæ•°æ®æŒä¹…åŒ–

**æ”¾ç½®è§„åˆ™**:
- âœ… æ•°æ®æ¨¡å‹ â†’ `market/src/models/xxx_entity.rs` (FromRow) æˆ– `xxx_dto.rs`
- âœ… æ•°æ®è®¿é—® â†’ `market/src/repositories/xxx_service.rs`
- âœ… WebSocketæµ â†’ `market/src/streams/websocket_service.rs`
- âœ… äº¤æ˜“æ‰€é€‚é… â†’ `market/src/exchanges/xxx.rs`

**è¦æ±‚**:
- âœ… Entityä½¿ç”¨FromRow
- âœ… DTOç”¨äºç½‘ç»œä¼ è¾“
- âœ… ç»Ÿä¸€ä½¿ç”¨sqlx

**ç¦æ­¢**:
- âŒ ç­–ç•¥é€»è¾‘ã€é£é™©æ§åˆ¶é€»è¾‘

---

### `orchestration/` - ä»»åŠ¡è°ƒåº¦
**èŒè´£**: å®šæ—¶ä»»åŠ¡ã€å·¥ä½œæµç¼–æ’ã€äº‹ä»¶é©±åŠ¨

**æ”¾ç½®è§„åˆ™**:
- âœ… ä»»åŠ¡è°ƒåº¦ â†’ `orchestration/src/scheduler/xxx_scheduler.rs`
- âœ… å·¥ä½œæµ â†’ `orchestration/src/workflow/xxx_job.rs`
- âœ… äº‹ä»¶æ€»çº¿ â†’ `orchestration/src/event_bus/xxx.rs`
- âœ… ç­–ç•¥è¿è¡Œå™¨ â†’ `orchestration/src/strategy_runner/xxx.rs`

**è¦æ±‚**:
- âœ… åªåšç¼–æ’ï¼Œä¸åŒ…å«ä¸šåŠ¡é€»è¾‘
- âœ… è°ƒç”¨servicesæˆ–ä¸šåŠ¡åŒ…

**ç¦æ­¢**:
- âŒ ç›´æ¥å®ç°ç­–ç•¥é€»è¾‘
- âŒ ç›´æ¥æ•°æ®åº“æ“ä½œ

---

### `core/` - æ ¸å¿ƒåŸºç¡€è®¾æ–½
**èŒè´£**: é…ç½®ç®¡ç†ã€æ—¥å¿—ç³»ç»Ÿã€æ•°æ®åº“è¿æ¥æ± 

**æ”¾ç½®è§„åˆ™**:
- âœ… é…ç½®ç®¡ç† â†’ `core/src/config/xxx.rs`
- âœ… æ•°æ®åº“è¿æ¥æ±  â†’ `core/src/database/sqlx_pool.rs`
- âœ… Rediså®¢æˆ·ç«¯ â†’ `core/src/cache/redis_client.rs`
- âœ… æ—¥å¿—ç³»ç»Ÿ â†’ `core/src/logger/xxx.rs`
- âœ… é”™è¯¯ç±»å‹ â†’ `core/src/error/mod.rs`

**ç¦æ­¢**:
- âŒ ä¸šåŠ¡é€»è¾‘ã€å…·ä½“çš„ä¸šåŠ¡æ¨¡å‹

---

### `common/` - é€šç”¨å·¥å…·
**èŒè´£**: è¢«3+åŒ…ä½¿ç”¨çš„é€šç”¨å·¥å…·

**æ”¾ç½®è§„åˆ™**:
- âœ… é€šç”¨å·¥å…· â†’ `common/src/utils/xxx.rs`
- âœ… é€šç”¨ç±»å‹ â†’ `common/src/types/xxx.rs`
- âœ… é€šç”¨æšä¸¾ â†’ `common/src/constants/xxx_enums.rs`
- âœ… é€šç”¨é”™è¯¯ â†’ `common/src/errors/mod.rs`

**è¦æ±‚**:
- âœ… å¿…é¡»è¢«3+åŒ…ä½¿ç”¨
- âœ… æ— ä¸šåŠ¡é€»è¾‘

---

### `analytics/` - åˆ†ææŠ¥å‘Š
**èŒè´£**: æ€§èƒ½åˆ†æã€æŠ¥è¡¨ç”Ÿæˆ

**æ”¾ç½®è§„åˆ™**:
- âœ… æ€§èƒ½åˆ†æ â†’ `analytics/src/performance/xxx.rs`
- âœ… æŠ¥è¡¨ç”Ÿæˆ â†’ `analytics/src/reporting/xxx.rs`

**è¦æ±‚**:
- âœ… åªè¯»åˆ†æï¼Œä¸ä¿®æ”¹ä¸šåŠ¡æ•°æ®

---

### `ai-analysis/` - AIåˆ†æ
**èŒè´£**: æƒ…ç»ªåˆ†æã€äº‹ä»¶æ£€æµ‹ã€å½±å“é¢„æµ‹

**æ”¾ç½®è§„åˆ™**:
- âœ… æƒ…ç»ªåˆ†æ â†’ `ai-analysis/src/sentiment_analyzer/xxx.rs`
- âœ… äº‹ä»¶æ£€æµ‹ â†’ `ai-analysis/src/event_detector/xxx.rs`
- âœ… å½±å“é¢„æµ‹ â†’ `ai-analysis/src/market_impact_predictor/xxx.rs`

---

### `rust-quant-cli/` - ç¨‹åºå…¥å£
**èŒè´£**: åº”ç”¨ç¨‹åºå…¥å£ã€å‘½ä»¤è¡Œå‚æ•°è§£æ

**æ”¾ç½®è§„åˆ™**:
- âœ… ç¨‹åºå…¥å£ â†’ `rust-quant-cli/src/main.rs`
- âœ… å¯åŠ¨é€»è¾‘ â†’ `rust-quant-cli/src/app/bootstrap.rs`
- âœ… CLIåº“ â†’ `rust-quant-cli/src/lib.rs`

**è¦æ±‚**:
- âœ… åªåšå…¥å£ï¼Œå‚æ•°è§£æã€ç¨‹åºå¯åŠ¨
- âœ… ä¾èµ–orchestration

**ç¦æ­¢**:
- âŒ ä¸šåŠ¡é€»è¾‘

---

## ğŸ”— ä¾èµ–è§„åˆ™

### ä¾èµ–æ–¹å‘ (å•å‘ï¼Œä»ä¸Šåˆ°ä¸‹)
```
cli â†’ orchestration â†’ services â†’ domain (æ¥å£) + infrastructure (å®ç°)
                              â†“
                    strategies/risk/execution
                              â†“
                    market/indicators
                              â†“
                    core/common
```

### ä¾èµ–å€’ç½®åŸåˆ™ (DIP)
**serviceså±‚è®¿é—®infrastructureçš„æ­£ç¡®æ–¹å¼**:
- âœ… **å£°æ˜ä¾èµ–**: ä½¿ç”¨ `domain::traits::XxxRepository` (æ¥å£)
- âœ… **æ³¨å…¥å®ç°**: è¿è¡Œæ—¶æ³¨å…¥ `infrastructure::repositories::SqlxXxxRepository` (å…·ä½“å®ç°)
- âœ… **ç±»å‹å£°æ˜**: å­—æ®µç±»å‹ä¸º `Box<dyn XxxRepository>` æˆ– `Arc<dyn XxxRepository>`
- âŒ **ç¦æ­¢**: ç›´æ¥å£°æ˜ `SqlxXxxRepository` ç±»å‹

**ä¸ºä»€ä¹ˆè¿™æ ·è®¾è®¡**:
- domainå±‚å®šä¹‰æ¥å£ï¼ˆç¨³å®šï¼Œä¸å˜åŒ–ï¼‰
- infrastructureå±‚å®ç°æ¥å£ï¼ˆå¯æ›¿æ¢ï¼Œå¦‚MySQL â†’ PostgreSQLï¼‰
- serviceså±‚ä¾èµ–æ¥å£ï¼ˆè§£è€¦ï¼Œæ˜“äºæµ‹è¯•ï¼‰

### ç¦æ­¢ä¾èµ–
- âŒ domain ä¸èƒ½ä¾èµ–ä»»ä½•ä¸šåŠ¡åŒ…æˆ–åŸºç¡€è®¾æ–½
- âŒ infrastructure ä¸èƒ½ä¾èµ– strategies/risk/execution/services
- âŒ indicators ä¸èƒ½ä¾èµ– strategies/risk/execution/services
- âŒ strategies ä¸èƒ½ä¾èµ– risk/execution/orchestration/services
- âŒ risk ä¸èƒ½ä¾èµ– strategies/execution/orchestration/services
- âŒ execution ä¸èƒ½ä¾èµ– strategies/orchestration/services
- âŒ services ä¸èƒ½ç›´æ¥ä¾èµ–infrastructureçš„å…·ä½“ç±»å‹ï¼ˆåº”ä¾èµ–domainæ¥å£ï¼‰

---

## ğŸ“ å‘½åè§„èŒƒ

### æ–‡ä»¶å‘½å
- å®ä½“: `xxx.rs` (domain) æˆ– `xxx_entity.rs` (infrastructure)
- å€¼å¯¹è±¡: `xxx.rs`
- Repository: `xxx_repository.rs`
- Service: `xxx_service.rs`
- ç­–ç•¥: `xxx_executor.rs` æˆ– `xxx_strategy.rs`
- ä»»åŠ¡: `xxx_job.rs`
- æŒ‡æ ‡: `xxx.rs` æˆ– `xxx_indicator.rs`

### ç±»å‹å‘½å
- å®ä½“: `Xxx` (å¦‚ Order, Candle)
- å€¼å¯¹è±¡: `Xxx` (å¦‚ Price, Volume)
- Repository: `SqlxXxxRepository`
- Service: `XxxService`
- é”™è¯¯: `XxxError`

---

## âœ… å¿«é€Ÿæ£€æŸ¥æ¸…å•

æ–°å¢æˆ–è€…ä¿®æ”¹ä»£ç å‰æ£€æŸ¥:
- [ ] ä»£ç æ”¾åœ¨æ­£ç¡®çš„åŒ…ä¸­ï¼Ÿ
- [ ] æ–‡ä»¶æ”¾åœ¨æ­£ç¡®çš„ç›®å½•ä¸­ï¼Ÿ
- [ ] æ²¡æœ‰è¿åä¾èµ–è§„åˆ™ï¼Ÿ
- [ ] å‘½åç¬¦åˆè§„èŒƒï¼Ÿ
- [ ] domainåŒ…æ²¡æœ‰å¤–éƒ¨æ¡†æ¶ä¾èµ–ï¼Ÿ
- [ ] infrastructureå®ç°äº†domainæ¥å£ï¼Ÿ
